<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>Descent into Darkness</title>
<style>
  body { font-family: monospace; display: flex; flex-direction: column; align-items: center; margin: 4px; overflow-y: auto; background-color: #f2f2f2; }
  #message { min-height: 7em; display: flex; flex-direction: column; justify-content: flex-start; overflow: auto; }
  #gameContainer, #shop, #settingsMenu, #combatBtns, #fileInput { display: none; }
  .button-group { display: flex; justify-content: center; align-items: center; }
  button { margin: 4px; }
  .shop-item, .settings-item { display: block; text-align: center; margin: 6px; }
</style>
</head>
<body>
<div id='titleScreen' style='text-align: center;'>
  <h1>Descent into Darkness</h1>
  <button id='startBtn'>Die</button>
</div>

<div id='gameContainer' style='flex-direction: column; align-items: center;'>
  <div id='enemyStats' style='text-align: center;'></div>
  <br>
  <div id='message' style='text-align: center;'></div>
  <div id='combatBtns'>
    <button id='fightBtn'>Fight</button>
    <button id='runBtn'>Run</button>
  </div>
  <br>
  <div id='status' style='text-align: center;'></div>
  <br>
  <button id='exploreBtn'>Explore</button>
  <div class='button-group'>
  <button id='usePotBtn'>Use Potion</button>
  <button id='maxPotionsBtn'>Max Potions</button>
  </div>
  <button id='fightBossBtn' disabled>Fight Boss</button>
  <button id='shopBtn'>Visit Shop</button>
  <br>
  <button id='settingsBtn'>Settings</button>
  <div class='button-group'>
    <button id='saveBtn'>Save Game</button>
    <button id='loadBtn'>Load Game</button>
  </div>
  <div class='button-group'>
    <button id='exportBtn'>Export Save</button>
    <button id='importBtn'>Import Save</button>
  </div>
  <input type='file' id='fileInput' accept='.save' style='display: none;' onchange='importSave(event);' />
</div>

<div id='shop' style='text-align: center;'>
  <h3>Shop</h3>
  <div class='button-group'>
    <div class='shop-item'>
      <button id='buyPotionBtn'>Buy Potion</button>
      <div id='potionCost'></div>
    </div>
    <div class='shop-item'>
      <button id='buyMaxPotionsBtn'>Max Potions</button>
      <div id='maxPotionCost'></div>
    </div>
  </div>
  <div class='button-group'>
    <div class='shop-item'>
      <button id='buyWeaponBtn'>Buy Weapon</button>
      <div id='weaponCost'></div>
    </div>
    <div class='shop-item'>
      <button id='buyArmorBtn'>Buy Armor</button>
      <div id='armorCost'></div>
    </div>
  </div>
  <br>
  <button id='closeShopBtn'>Close Shop</button>
</div>

<div id='settingsMenu' style='text-align: center;'>
  <h3>Settings</h3>
  <div class='settings-item'>
    <label for='trackVolume'>Soundtrack Volume:</label>
	<span id='trackVolumeValue'></span>
	<br>
    <input type='range' id='trackVolume' min='0' max='100' value='50'>
  </div>
  <div class='settings-item'>
    <label for='effectVolume'>Sound Effect Volume:</label>
	<span id='effectVolumeValue'></span>
	<br>
    <input type='range' id='effectVolume' min='0' max='100' value='50'>
  </div>
  <br>
  <button id='resetSaveBtn'>Reset Save Data</button>
  <br>
  <br>
  <button id='closeSettingsBtn'>Close Settings</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

const el = id => document.getElementById(id);
const titleScreen = el('titleScreen');
const gameContainer = el('gameContainer');
const startBtn = el('startBtn');
const message = el('message');
const status = el('status');
const exploreBtn = el('exploreBtn');
const usePotBtn = el('usePotBtn');
const maxPotionsBtn = el('maxPotionsBtn');
const shopBtn = el('shopBtn');
const shop = el('shop');
const buyWeaponBtn = el('buyWeaponBtn');
const buyArmorBtn = el('buyArmorBtn');
const buyPotionBtn = el('buyPotionBtn');
const buyMaxPotionsBtn = el('buyMaxPotionsBtn');
const closeShopBtn = el('closeShopBtn');
const fightBossBtn = el('fightBossBtn');
const enemyStats = el('enemyStats');
const combatBtns = el('combatBtns');
const saveBtn = el('saveBtn');
const loadBtn = el('loadBtn');
const exportBtn = el('exportBtn');
const importBtn = el('importBtn');
const fileInput = el('fileInput');
const resetSaveBtn = el('resetSaveBtn');
const settingsMenu = el('settingsMenu');
const settingsBtn = el('settingsBtn');
const closeSettingsBtn = el('closeSettingsBtn');
const trackVolume = el('trackVolume');
const effectVolume = el('effectVolume');
const trackVolumeValue = el('trackVolumeValue');
const effectVolumeValue = el('effectVolumeValue');


const game = (() => {
	
	return {
	soundEffects: {
		victory: [['C5', 0.1], ['E5', 0.1], ['G5', 0.1], ['B5', 0.1], ['D6', 0.1], ['C6', 0.1]],
		levelUp: [['G4', 0.2], ['D#5', 0.2], ['G5', 0.2], ['C6', 0.2], ['D#6', 0.2], ['G6', 0.2]],
		nextFloor: [['A3', 0.3], ['E4', 0.3], ['A4', 0.3], ['E5', 0.3]],
		playerDeath: [['C3', 0.15], ['G3', 0.15], ['C4', 0.15], ['G4', 0.15], ['C5', 0.15], ['C4', 0.15], ['G3', 0.15], ['C3', 0.15]],
	},
	
	soundTracks: {
	epicAdventure: [
    ['C4', 0.3], ['E4', 0.3], ['G4', 0.3], ['C5', 0.3], ['G4', 0.3], ['E4', 0.3],
    ['A3', 0.3], ['C4', 0.3], ['E4', 0.3], ['A4', 0.3], ['E4', 0.3], ['C4', 0.3],
    ['F3', 0.3], ['A3', 0.3], ['C4', 0.3], ['F4', 0.3], ['C4', 0.3], ['A3', 0.3],
    ['G3', 0.3], ['B3', 0.3], ['D4', 0.3], ['G4', 0.3], ['D4', 0.3], ['B3', 0.3],

    ['E4', 0.3], ['G4', 0.3], ['B4', 0.3], ['E5', 0.3], ['B4', 0.3], ['G4', 0.3],
    ['D4', 0.3], ['F#4', 0.3], ['A4', 0.3], ['D5', 0.3], ['A4', 0.3], ['F#4', 0.3],
    ['C4', 0.3], ['E4', 0.3], ['G4', 0.3], ['C5', 0.3], ['G4', 0.3], ['E4', 0.3],
    ['G3', 0.3], ['B3', 0.3], ['D4', 0.3], ['G4', 0.3], ['D4', 0.3], ['B3', 0.3],

    ['C4', 0.3], ['E4', 0.3], ['G4', 0.3], ['C5', 0.3], ['G4', 0.3], ['E4', 0.3],
    ['A3', 0.3], ['C4', 0.3], ['E4', 0.3], ['A4', 0.3], ['E4', 0.3], ['C4', 0.3],
    ['F3', 0.3], ['A3', 0.3], ['C4', 0.3], ['F4', 0.3], ['C4', 0.3], ['A3', 0.3],
    ['G3', 0.3], ['B3', 0.3], ['D4', 0.3], ['G4', 0.3], ['D4', 0.3], ['B3', 0.3],
  ],
  
  darkMysticJourney: [
    ['F2', 0.4], ['C3', 0.4], ['F3', 0.8], ['A3', 0.8],
    ['E2', 0.4], ['B2', 0.4], ['E3', 0.8], ['G#3', 0.8],
    ['G2', 0.4], ['D3', 0.4], ['G3', 0.8], ['B3', 0.8],
    ['A2', 0.4], ['E3', 0.4], ['A3', 0.8], ['C#4', 0.8],
],
  
  forgottenKingdoms: [

    ['C3', 0.4], ['E3', 0.4], ['G3', 0.8], ['C4', 0.8], ['G3', 0.4], ['E3', 0.4],
    ['A2', 0.4], ['D3', 0.4], ['F3', 0.8], ['A3', 0.8], ['F3', 0.4], ['D3', 0.4],
    ['D#2', 0.4], ['G2', 0.4], ['A#2', 0.8], ['D#3', 0.8], ['A#2', 0.4], ['G2', 0.4],
    ['G2', 0.4], ['C3', 0.4], ['D#3', 0.8], ['G3', 0.8], ['D#3', 0.4], ['C3', 0.4],
  ],

legendaryBanger: [
    ['E4', 0.2], ['G4', 0.2], ['B4', 0.2], ['E5', 0.2], ['B4', 0.2], ['G4', 0.2],
    ['C5', 0.2], ['E5', 0.2], ['G5', 0.2], ['C6', 0.2], ['G5', 0.2], ['E5', 0.2],
    ['B4', 0.2], ['D5', 0.2], ['F#5', 0.2], ['B5', 0.2], ['F#5', 0.2], ['D5', 0.2],
    ['G4', 0.2], ['B4', 0.2], ['D5', 0.2], ['G5', 0.2], ['D5', 0.2], ['B4', 0.2],
],
  
DarkMystique: [
    ['E2', 0.2], ['G2', 0.2], ['B2', 0.2], ['E3', 0.2], ['B2', 0.2], ['G2', 0.2],
    ['C3', 0.2], ['E3', 0.2], ['G3', 0.2], ['C4', 0.2], ['G3', 0.2], ['E3', 0.2],
    ['B2', 0.2], ['D3', 0.2], ['F#3', 0.2], ['B3', 0.2], ['F#3', 0.2], ['D3', 0.2],
    ['G2', 0.2], ['B2', 0.2], ['D3', 0.2], ['G3', 0.2], ['D3', 0.2], ['B2', 0.2],
],

dungeonDelverAnthem: [
    ['C4', 0.25], ['G3', 0.25], ['E4', 0.5], ['G4', 0.5],
    ['C5', 0.25], ['G4', 0.25], ['E4', 0.5], ['C4', 0.5],

    ['A3', 0.25], ['E3', 0.25], ['C4', 0.5], ['E4', 0.5],
    ['A4', 0.25], ['E4', 0.25], ['C4', 0.5], ['A3', 0.5],

    ['D4', 0.25], ['A3', 0.25], ['F4', 0.5], ['A4', 0.5],
    ['D5', 0.25], ['A4', 0.25], ['F4', 0.5], ['D4', 0.5],

    ['G4', 0.25], ['D4', 0.25], ['B3', 0.5], ['D4', 0.5],
    ['G4', 0.25], ['D4', 0.25], ['B3', 0.5], ['G3', 0.5],
  ],

  fantasySaga: [
    ['C4', 0.4], ['G4', 0.4], ['E4', 0.4], ['G4', 0.4],
    ['C5', 0.4], ['G4', 0.4], ['E4', 0.4], ['C4', 0.4],

    ['A3', 0.4], ['E4', 0.4], ['C4', 0.4], ['E4', 0.4],
    ['A4', 0.4], ['E4', 0.4], ['C4', 0.4], ['A3', 0.4],

    ['D4', 0.4], ['A4', 0.4], ['F4', 0.4], ['A4', 0.4],
    ['D5', 0.4], ['A4', 0.4], ['F4', 0.4], ['D4', 0.4],
	],
	
	dungeonCrusader: [
    ['E4', 0.3], ['G4', 0.3], ['B4', 0.6], ['E5', 0.6], ['B4', 0.3], ['G4', 0.3],
    ['C5', 0.3], ['E5', 0.3], ['G5', 0.6], ['C6', 0.6], ['G5', 0.3], ['E5', 0.3],

    ['B4', 0.3], ['D5', 0.3], ['F#5', 0.6], ['B5', 0.6], ['F#5', 0.3], ['D5', 0.3],
    ['G4', 0.3], ['B4', 0.3], ['D5', 0.6], ['G5', 0.6], ['D5', 0.3], ['B4', 0.3],
  ],
  
  shadowSlayer: [
    ['E4', 0.3], ['G4', 0.3], ['B4', 0.6], ['G4', 0.3], ['E4', 0.3], ['B3', 0.6],
    ['D4', 0.3], ['F#4', 0.3], ['A4', 0.6], ['F#4', 0.3], ['D4', 0.3], ['A3', 0.6],

    ['C4', 0.3], ['E4', 0.3], ['G4', 0.6], ['E4', 0.3], ['C4', 0.3], ['G3', 0.6],
    ['B3', 0.3], ['D4', 0.3], ['F#4', 0.6], ['D4', 0.3], ['B3', 0.3], ['F#3', 0.6],
  ],

  arcaneInferno: [
    ['G4', 0.3], ['E4', 0.3], ['D4', 0.6], ['B3', 0.3], ['G3', 0.3], ['E3', 0.3],
    ['A3', 0.2], ['C4', 0.2], ['E4', 0.4], ['A4', 0.6], ['E4', 0.2], ['C4', 0.2],

    ['F4', 0.4], ['D4', 0.4], ['C4', 0.4], ['A3', 0.3], ['F3', 0.3], ['D3', 0.3],
    ['G3', 0.2], ['B3', 0.2], ['D4', 0.4], ['G4', 0.6], ['D4', 0.2], ['B3', 0.2],

    ['E4', 0.3], ['G4', 0.3], ['B4', 0.3], ['E5', 0.3], ['B4', 0.3], ['G4', 0.3],
    ['A4', 0.2], ['C5', 0.2], ['E5', 0.4], ['A5', 0.6], ['E5', 0.2], ['C5', 0.2],

    ['F4', 0.4], ['A4', 0.4], ['C5', 0.4], ['F5', 0.3], ['C5', 0.3], ['A4', 0.3],
    ['G4', 0.2], ['B4', 0.2], ['D5', 0.4], ['G5', 0.6], ['D5', 0.2], ['B4', 0.2],
  ],
  
  arcaneLabyrinth2: [
    ['G4', 0.4], ['E4', 0.4], ['C4', 0.4], ['G3', 0.4], ['C4', 0.4], ['E4', 0.4],
    ['F4', 0.4], ['D4', 0.4], ['B3', 0.4], ['F3', 0.4], ['B3', 0.4], ['D4', 0.4],

    ['E4', 0.4], ['C4', 0.4], ['A3', 0.4], ['E3', 0.4], ['A3', 0.4], ['C4', 0.4],
    ['D4', 0.4], ['B3', 0.4], ['G3', 0.4], ['D3', 0.4], ['G3', 0.4], ['B3', 0.4],

    ['C4', 0.4], ['A3', 0.4], ['E3', 0.4], ['C3', 0.4], ['E3', 0.4], ['A3', 0.4],
    ['B3', 0.4], ['G3', 0.4], ['D3', 0.4], ['B2', 0.4], ['D3', 0.4], ['G3', 0.4],

    ['A3', 0.4], ['F3', 0.4], ['C3', 0.4], ['A2', 0.4], ['C3', 0.4], ['F3', 0.4],
    ['G3', 0.4], ['E3', 0.4], ['C3', 0.4], ['G2', 0.4], ['C3', 0.4], ['E3', 0.4],
  ],
  
  enigmaticRiddle: [
    ['D4', 0.4], ['F#4', 0.6], ['A4', 0.4], ['D5', 0.6], ['A4', 0.4], ['F#4', 0.6],
    ['G4', 0.4], ['B4', 0.6], ['D5', 0.4], ['G5', 0.6], ['D5', 0.4], ['B4', 0.6],

    ['A4', 0.4], ['C5', 0.6], ['E5', 0.4], ['A5', 0.6], ['E5', 0.4], ['C5', 0.6],
    ['E4', 0.4], ['G4', 0.6], ['B4', 0.4], ['E5', 0.6], ['B4', 0.4], ['G4', 0.6],

    ['C5', 0.4], ['E5', 0.6], ['G5', 0.4], ['C6', 0.6], ['G5', 0.4], ['E5', 0.6],
    ['F4', 0.4], ['A4', 0.6], ['C5', 0.4], ['F5', 0.6], ['C5', 0.4], ['A4', 0.6],

    ['B4', 0.4], ['D5', 0.6], ['F#5', 0.4], ['B5', 0.6], ['F#5', 0.4], ['D5', 0.6],
    ['G4', 0.4], ['B4', 0.6], ['D5', 0.4], ['G5', 0.6], ['D5', 0.4], ['B4', 0.6],
  ],
  
  arcaneWanderer: [
    ['F4', 0.3], ['A4', 0.5], ['C5', 0.3], ['F5', 0.5], ['C5', 0.3], ['A4', 0.5],
    ['G4', 0.3], ['B4', 0.5], ['D5', 0.3], ['G5', 0.5], ['D5', 0.3], ['B4', 0.5],

    ['A4', 0.3], ['C5', 0.5], ['E5', 0.3], ['A5', 0.5], ['E5', 0.3], ['C5', 0.5],
    ['E4', 0.3], ['G4', 0.5], ['B4', 0.3], ['E5', 0.5], ['B4', 0.3], ['G4', 0.5],

    ['C5', 0.3], ['E5', 0.5], ['G5', 0.3], ['C6', 0.5], ['G5', 0.3], ['E5', 0.5],
    ['F4', 0.3], ['A4', 0.5], ['C5', 0.3], ['F5', 0.5], ['C5', 0.3], ['A4', 0.5],

    ['B4', 0.3], ['D5', 0.5], ['F#5', 0.3], ['B5', 0.5], ['F#5', 0.3], ['D5', 0.5],
    ['G4', 0.3], ['B4', 0.5], ['D5', 0.3], ['G5', 0.5], ['D5', 0.3], ['B4', 0.5],
  ],
  
  relentlessFoes: [
    ['D4', 0.15], ['F4', 0.15], ['A4', 0.15], ['D5', 0.15], ['A4', 0.15], ['F4', 0.15],
    ['C4', 0.15], ['E4', 0.15], ['G4', 0.15], ['C5', 0.15], ['G4', 0.15], ['E4', 0.15],
    ['B3', 0.15], ['D4', 0.15], ['F4', 0.15], ['B4', 0.15], ['F4', 0.15], ['D4', 0.15],
    ['G3', 0.15], ['B3', 0.15], ['D4', 0.15], ['G4', 0.15], ['D4', 0.15], ['B3', 0.15],
  ],
  
endlessAbyss: [
  ['G2', 0.5], ['D3', 0.5], ['A2', 0.5], ['D3', 0.5],
  ['G2', 0.5], ['D3', 0.5], ['A2', 0.5], ['D3', 0.5],
  ['F2', 0.5], ['C3', 0.5], ['G2', 0.5], ['C3', 0.5],
  ['F2', 0.5], ['C3', 0.5], ['G2', 0.5], ['C3', 0.5],
  ['E2', 0.5], ['B2', 0.5], ['F2', 0.5], ['B2', 0.5],
  ['E2', 0.5], ['B2', 0.5], ['F2', 0.5], ['B2', 0.5],
  ['D2', 0.5], ['A2', 0.5], ['E2', 0.5], ['A2', 0.5],
  ['D2', 0.5], ['A2', 0.5], ['E2', 0.5], ['A2', 0.5],
],
 
 pulseOfChaos: [
    ['D2', 0.2], ['G2', 0.2], ['A#2', 0.2], ['D3', 0.6], ['A#2', 0.2], ['G2', 0.2],
    ['E2', 0.2], ['G2', 0.2], ['B2', 0.2], ['E3', 0.6], ['B2', 0.2], ['G2', 0.2],

    ['F2', 0.2], ['A#2', 0.2], ['C#3', 0.2], ['F3', 0.6], ['C#3', 0.2], ['A#2', 0.2],
    ['D2', 0.2], ['G2', 0.2], ['A#2', 0.2], ['D3', 0.6], ['A#2', 0.2], ['G2', 0.2],

    ['C2', 0.2], ['E2', 0.2], ['G2', 0.2], ['C3', 0.6], ['G2', 0.2], ['E2', 0.2],
    ['D2', 0.2], ['G2', 0.2], ['A#2', 0.2], ['D3', 0.6], ['A#2', 0.2], ['G2', 0.2],
],

rageUnleashed: [
    ['F2', 0.25], ['G#2', 0.25], ['C3', 0.25], ['F3', 0.5], ['C3', 0.25], ['G#2', 0.5],
    ['D#2', 0.25], ['G#2', 0.25], ['A#2', 0.25], ['D#3', 0.5], ['A#2', 0.25], ['G#2', 0.5],

    ['G2', 0.25], ['A#2', 0.25], ['D3', 0.25], ['G3', 0.5], ['D3', 0.25], ['A#2', 0.5],
    ['F2', 0.25], ['G#2', 0.25], ['C3', 0.25], ['F3', 0.5], ['C3', 0.25], ['G#2', 0.5],

    ['C#2', 0.25], ['F2', 0.25], ['G#2', 0.25], ['C#3', 0.5], ['G#2', 0.25], ['F2', 0.5],
],
  
abyssalAvalanche: [
    ['C2', 0.5], ['G2', 0.25], ['D#3', 0.75], ['C3', 0.25], ['D#3', 0.5], ['G2', 0.75],
    ['A#2', 0.5], ['F2', 0.25], ['C3', 0.75], ['A#2', 0.25], ['C3', 0.5], ['F2', 0.75],

    ['D2', 0.5], ['A2', 0.25], ['F3', 0.75], ['D3', 0.25], ['F3', 0.5], ['A2', 0.75],
    ['C3', 0.5], ['G#2', 0.25], ['D#3', 0.75], ['C3', 0.25], ['D#3', 0.5], ['G#2', 0.75],

    ['G2', 0.5], ['D2', 0.25], ['A#2', 0.75], ['G2', 0.25], ['A#2', 0.5], ['D2', 0.75],
    ['F2', 0.5], ['C2', 0.25], ['G#2', 0.75], ['F2', 0.25], ['G#2', 0.5], ['C2', 0.75],

    ['A2', 0.5], ['E2', 0.25], ['C3', 0.75], ['A2', 0.25], ['C3', 0.5], ['E2', 0.75],
    ['D3', 0.5], ['A#2', 0.25], ['F3', 0.75], ['D3', 0.25], ['F3', 0.5], ['A#2', 0.75],
],

seismicSurge: [
    ['F2', 0.4], ['C3', 0.4], ['A#2', 0.2], ['F3', 0.8], ['C3', 0.4], ['A#2', 0.4],
    ['G#2', 0.4], ['D3', 0.4], ['B2', 0.2], ['G#3', 0.8], ['D3', 0.4], ['B2', 0.4],

    ['G2', 0.4], ['D3', 0.4], ['A#2', 0.2], ['G3', 0.8], ['D3', 0.4], ['A#2', 0.4],
    ['F2', 0.4], ['C3', 0.4], ['A#2', 0.2], ['F3', 0.8], ['C3', 0.4], ['A#2', 0.4],

    ['E2', 0.4], ['B2', 0.4], ['G#2', 0.2], ['E3', 0.8], ['B2', 0.4], ['G#2', 0.4],
    ['G2', 0.4], ['D3', 0.4], ['B2', 0.2], ['G3', 0.8], ['D3', 0.4], ['B2', 0.4],

    ['F2', 0.4], ['C3', 0.4], ['A#2', 0.2], ['F3', 0.8], ['C3', 0.4], ['A#2', 0.4],
    ['G#2', 0.4], ['D3', 0.4], ['B2', 0.2], ['G#3', 0.8], ['D3', 0.4], ['B2', 0.4],
],
},
	
	text: {
		startGame: [
			"You wake up in a dark, unfamiliar place...<br>Unarmed and dressed in rags...<br>Decrepit skeletons scattered across the floor...<br>You must find a way out of this place...",
			"Darkness surrounds you...<br>Clad in tattered rags, you shiver...<br>Bones litter the ground...<br>A desperate search for escape begins...",
  "In the cold, black void you awaken...<br>Wearing only ragged clothes...<br>Skeletal remains scattered nearby...<br>You must flee this forsaken place...",
  "You find yourself in inky shadows...<br>Dressed in mere scraps...<br>Grinning skulls stare back at you...<br>A desperate escape is your only hope...",
    "The void stirs as you open your eyes...<br>Wrapped in tattered cloth...<br>A graveyard of bones surrounds you...<br>Find your way out or perish...",
    "As darkness recedes, you awaken...<br>Clothed in frayed vestments...<br>A chilling sight greets you...<br>Fight for your escape...",
	"Awakening in cold, unyielding darkness...<br>Clad in tattered garments...<br>A sea of bones surrounds you...<br>Escape or succumb to the shadows...",
    "You emerge from slumber in a murky crypt...<br>Wearing threadbare rags...<br>Skeletal remnants scattered about...<br>Survive and flee this wretched place...",
    "You awaken in the gloom, shivering...<br>Dressed in worn, ragged attire...<br>Surrounded by lifeless remains...<br>Seek a way out or perish...",
    "Rising from the blackness, disoriented...<br>Clad in weathered rags...<br>Skulls and bones abound...<br>Desperation fuels your escape...",
    "You find yourself in a cryptic chamber...<br>Garbed in tattered cloth...<br>Bones strewn about like macabre confetti...<br>Find the exit or join the fallen...",
    "The darkness releases you, bleary-eyed...<br>Clothed in frayed remnants...<br>A graveyard of skeletons awaits...<br>Struggle for freedom or face oblivion...",
    "You rouse from a restless sleep...<br>Wearing tattered scraps...<br>Surrounded by skeletal remnants...<br>Forge a path to freedom or perish...",
    "In the shadows, you stir...<br>Dressed in worn, ragged clothes...<br>Death's evidence surrounds you...<br>Escape the darkness or be consumed...",
    "You awaken amidst an ocean of darkness...<br>Clad in disheveled attire...<br>Lifeless bones scattered around...<br>Seek the light or dwell in darkness...",
    "Eyes opening to a shroud of blackness...<br>Garbed in threadbare rags...<br>The crypt's chilling denizens surround you...<br>Fight to escape the abyss...",
		],
		loadGame: [
  "As the shadows part, your memories resurface...<br>Once more, you stand amidst the darkness...",
  "The veil of darkness lifts, revealing a familiar scene...<br>You return to the heart of the crypt...",
  "The murky haze dissipates, and your journey resumes...<br>Darkness and secrets surround you once again...",
  "A shroud of blackness retreats, and the crypt re-emerges...<br>Your quest continues, fraught with peril...",
  "Emerging from the abyss, your senses return...<br>The crypt's mysteries await your exploration...",
  "As the gloom recedes, your memories awaken...<br>The crypt's depths welcome you back...",
    "The shadowy veil dissipates, and you stand ready...<br>Once more, the crypt beckons...",
    "Darkness retreats, unveiling familiar surroundings...<br>Your journey in the crypt resumes...",
    "The black fog clears, revealing the crypt's hidden paths...<br>Determination fuels your return...",
    "Emerging from darkness, your purpose reignites...<br>The crypt's mysteries call out to you...",
	"As darkness yields, your resolve strengthens...<br>The crypt awaits your return...",
    "The shadows recede, revealing your path...<br>Once again, you venture into the unknown...",
    "The veil of night lifts, and you resume your quest...<br>Within the crypt, secrets remain...",
    "Darkness withdraws, your journey beckons...<br>The crypt's depths call to you...",
    "As the gloom dissipates, your memories awaken...<br>Your path through the crypt unfolds...",
    "The shadows vanish, your purpose renewed...<br>Into the crypt's depths, you plunge...",
    "As the darkness wanes, you forge onward...<br>The crypt's mysteries await...",
    "The black haze clears, and you step forward...<br>With determination, you navigate the crypt...",
	"As the darkness recedes, your purpose rekindles...<br>The crypt's enigmas demand your attention...",
    "Emerging from the void, your vision clears...<br>The crypt's labyrinthine paths call to you...",
    "The shadows lift, and your resolve intensifies...<br>Once more, you brave the crypt's depths...",
    "Darkness dissipates, revealing the crypt's secrets...<br>With determination, you continue your quest...",
    "As the gloom clears, your journey resumes...<br>Plunging further into the crypt's mysteries...",
	"As shadows disperse, your memory stirs...<br>Into the crypt's darkness, you venture once more...",
    "The dark veil lifts, exposing a familiar world...<br>Returning to the crypt's enigmatic embrace...",
    "Gloom recedes, and your path is revealed...<br>The crypt's depths beckon once again...",
    "The black mist fades, unveiling the crypt's secrets...<br>Your journey through the darkness resumes...",
    "Emerging from the void, your mind sharpens...<br>The crypt's challenges call to you...",
    "As the darkness ebbs, your spirit reawakens...<br>You delve deeper into the crypt's mysteries...",
    "The shadows retreat, disclosing your path...<br>Your exploration of the crypt continues...",
    "Darkness vanishes, and the crypt reappears...<br>With renewed vigor, you pursue its secrets...",
    "As the gloom clears, your journey unfolds...<br>The crypt's hidden paths entice you...",
    "The dark haze dissipates, and your quest resumes...<br>Facing the crypt's enigmas with courage...",
    "Emerging from the shadows, your focus sharpens...<br>The crypt's depths summon you...",
    "As the darkness fades, your path reemerges...<br>Once again, you brave the crypt's labyrinth...",
    "The veil of obscurity lifts, exposing the crypt...<br>With determination, you seek its hidden truths...",
    "Shadows disperse, and your senses awaken...<br>The crypt's challenges demand your attention...",
    "Darkness gives way, revealing your surroundings...<br>Into the crypt's depths, you forge ahead...",
],
		defeatBoss: [
  "The fallen foe crumbles to dust before your eyes...<br>A sense of triumph courses through your veins...",
  "As the dark entity's final breath escapes its lips...<br>Victory and relief wash over you...",
  "The malevolent being collapses, vanquished...<br>You stand victorious amidst the darkness...",
   "The mighty adversary falls, defeated...<br>A triumphant roar escapes your lips...",
    "The monstrous foe crumbles before you...<br>Your courage and skill rewarded...",
    "As the fearsome beast lies vanquished...<br>You bask in the glory of your hard-won victory...",
    "The tyrant's reign ends, defeated by your hand...<br>A surge of pride fills your heart...",
    "The great enemy succumbs to your strength...<br>As it collapses, you feel your power swell...",
	"With a final, crushing blow, the behemoth is vanquished...<br>Exhilaration surges through you...",
    "The darkness recoils as the villainous foe is slain...<br>Victory is yours...",
    "As your nemesis withers, defeated...<br>Your heart swells with pride...",
    "The vanquished foe collapses in defeat...<br>A triumphant sense of accomplishment fills you...",
    "The wicked oppressor falls, its reign of terror ended...<br>You bask in the glow of victory...",
	"The dreadful beast falls, succumbing to your might...<br>Relief and satisfaction surge within you...",
    "The fearsome creature lies slain at your feet...<br>A sense of accomplishment empowers you...",
    "The defeated adversary crumbles away...<br>Revel in the hard-fought victory...",
    "As the darkness retreats, the fallen foe withers...<br>You stand tall, triumphant...",
    "The vanquished enemy's form dissolves...<br>You bask in the spoils of your conquest...",
	"The formidable foe crumbles, defeated...<br>A wave of triumph washes over you...",
    "The monstrous adversary yields, broken...<br>Exultation fills your heart...",
    "The dark creature withers, vanquished...<br>Your victory resounds through the crypt...",
    "The twisted enemy falls, overcome...<br>Success and pride fuel your spirit...",
    "The towering menace collapses, beaten...<br>You stand tall in the face of victory...",
    "As the fearsome oppressor succumbs...<br>Your strength and courage are celebrated...",
    "The malevolent force is broken, defeated...<br>Victorious, you bask in the glow of triumph...",
    "The wicked enemy falters, bested...<br>A swell of achievement invigorates you...",
    "The vile creature lies vanquished...<br>You revel in the spoils of your hard-earned victory...",
    "The dark nemesis is silenced, defeated...<br>Your heart swells with the joy of success...",
    "The monstrous terror falls before you...<br>Victory's sweet taste engulfs you...",
    "The sinister foe crumbles in defeat...<br>A sense of accomplishment fills your soul...",
    "The fearsome enemy lies beaten...<br>Triumphant, you stand amidst the chaos...",
    "The dark lord yields to your strength...<br>Victory and relief flood your senses...",
    "The menacing adversary topples, vanquished...<br>You bask in the euphoria of conquest...",
],
		enemyEncounter: [
    "A chilling wind passes...<br>You sense a malevolent presence...<br>Your heartbeat quickens...",
    "The shadows come alive...<br>A sinister figure emerges...<br>Its eyes burn with hatred...",
    "An eerie silence fills the air...<br>Broken by the sound of labored breathing...<br>A monstrous creature stands before you...",
	 "A sudden chill seizes your spine...<br>An unseen threat lurks nearby...<br>Prepare for battle...",
    "The darkness stirs, restless...<br>A malicious presence draws near...<br>Brace yourself...",
    "The air thickens, malevolent...<br>A sinister foe emerges...<br>Steel your resolve...",
    "Cold sweat trickles down your brow...<br>An evil adversary approaches...<br>Ready your defenses...",
    "A heavy dread weighs upon you...<br>A wicked creature materializes...<br>Stand your ground...",
	"The air crackles with malice...<br>A shadowy form takes shape...<br>Prepare for combat...",
    "An oppressive gloom settles upon you...<br>An abhorrent being rises from the depths...<br>Face your fears...",
    "The ground trembles beneath you...<br>A twisted creature bursts forth...<br>Confront the monstrosity...",
    "A haunting whisper echoes...<br>An entity of pure hatred coalesces...<br>Defend yourself...",
    "Your surroundings darken further...<br>An evil apparition looms before you...<br>Fight or perish...",
	"An unsettling aura engulfs you...<br>A malevolent figure emerges...<br>Gather your courage...",
    "The darkness pulses ominously...<br>A wicked entity appears...<br>Steady your nerves...",
    "An icy shiver races down your spine...<br>A monstrous beast confronts you...<br>Face the challenge...",
    "The shadows thicken, foreboding...<br>A vile creature reveals itself...<br>Prepare for the struggle...",
    "A hushed terror fills the air...<br>A sinister presence approaches...<br>Stand firm...",
    "An eerie calm descends...<br>A dark figure materializes...<br>Brace for impact...",
    "The air hums with malevolence...<br>An evil foe steps forth...<br>Summon your strength...",
    "A sudden silence chills the air...<br>A ghastly being emerges...<br>Resist its wickedness...",
    "The atmosphere grows heavy with dread...<br>A malicious creature lunges...<br>Defy the darkness...",
    "An unnerving hush blankets the area...<br>A sinister adversary takes shape...<br>Ready yourself for battle...",
    "A palpable fear grips the air...<br>A twisted menace approaches...<br>Confront the terror...",
    "The shadows grow restless...<br>An ominous being arises...<br>Prepare for the onslaught...",
    "A cold sweat overtakes you...<br>A loathsome creature appears...<br>Gird yourself for combat...",
    "The darkness trembles with menace...<br>A vile apparition materializes...<br>Face the nightmare...",
    "A sinister chill envelops you...<br>A wretched foe looms...<br>Hold your ground...",
],
		nothingFound: [
    "The gloom conceals secrets yet to be discovered...<br>You find nothing...",
    "You search high and low...<br>all you find is dust and cobwebs...",
	"You scour the darkness, vigilant...<br>But your search yields nothing...",
    "Your eyes dart through the shadows...<br>Yet there is nothing to be found...",
    "The blackness hides its secrets well...<br>Your efforts are fruitless...",
    "You probe the gloom, seeking answers...<br>But none are forthcoming...",
    "The void whispers, taunting you...<br>But offers no rewards...",
	"You sift through the shadows...<br>Only to be met with emptiness...",
    "You probe the darkness, hopeful...<br>But your search proves fruitless...",
    "Your investigation yields naught...<br>The darkness holds fast to its secrets...",
    "You delve into the void...<br>But it offers no consolation...",
    "Despite your efforts, nothing is revealed...<br>The enigmatic darkness mocks you...",
	"You comb the darkness, ever vigilant...<br>But your search reveals nothing...",
    "You seek treasures hidden in the gloom...<br>Yet all remains concealed...",
    "The darkness whispers secrets...<br>But none are within your grasp...",
    "You scour the shadows, undeterred...<br>But your efforts remain unrewarded...",
    "You search the void with keen eyes...<br>But nothing of value emerges...",
    "The blackness conceals its mysteries...<br>Your pursuit yields no results...",
    "You delve into the shadows, seeking answers...<br>But the darkness remains enigmatic...",
    "You examine every corner of the gloom...<br>Yet your efforts go unrequited...",
    "Your gaze pierces the darkness...<br>But the void offers no respite...",
    "You rummage through the shadows, determined...<br>But your search bears no fruit...",
    "The darkness conceals its riches...<br>And yields nothing to your quest...",
    "You tirelessly probe the gloom...<br>But it remains unyielding...",
],
		healingShrine: [
    "A skeletal figure emerges, its touch healing...<br>Surprisingly, a sense of comfort envelops you...",
    "A bone shrine radiates an eerie light...<br>As it touches you, your wounds close...",
    "An ancient healer, its body long decayed...<br>Yet its spirit remains, mending your injuries...",
    "A chilling touch, yet strangely soothing...<br>The skeletal healer's work restores you...",
    "The walls are lined with skulls...<br>Whispering incantations of healing and solace...",
    "A spectral figure of bone and sinew...<br>Its touch restores your vitality...",
    "Skeletal hands hover over your injuries...<br>Sealing your wounds with a spectral glow...",
    "A bony visage imparts its healing energy...<br>Reviving your strength and determination...",
    "The shrine of bone and darkness...<br>Somehow, it mends your wounds...",
    "A skeletal healer, its intentions pure...<br>Its touch repairs your body and calms your mind...",
    "An otherworldly light flickers within a ribcage...<br>Healing your body and invigorating your spirit...",
    "A ghostly hand, its touch chilling yet healing...<br>Replenishing your energy...",
    "In the depths, a macabre shrine...<br>Its strange power rejuvenates your spirit...",
    "A ghastly figure of bone and shadow...<br>Its healing touch banishes your pain...",
    "An eerie glow surrounds a skeletal healer...<br>Reviving your strength and resolve...",
	"A gentle radiance emanates from the shadows...<br>As you approach, your wounds begin to heal...",
	"An ethereal healer, bones aglow...<br>Its spectral touch restores your vitality...",
    "A shrine of skulls, their eyes alight...<br>As they gaze upon you, your wounds fade...",
    "A skeletal hand extends, its touch chilling...<br>Yet your body is mended, your spirit renewed...",
    "An ancient healer of bone and shadow...<br>Its ghostly touch weaves your wounds closed...",
    "The crypt's darkness parts, revealing a shrine...<br>Bones flicker with light, healing your injuries...",
    "A spectral figure, its skeletal form radiant...<br>As it reaches for you, your pain dissipates...",
    "A shrine of bones, their whispers soothing...<br>Your wounds close, the darkness receding...",
    "A macabre shrine, its power undeniable...<br>As skeletal hands touch you, healing ensues...",
    "A ghostly healer, its bones gleaming...<br>As it mends your injuries, your spirit soars...",
],
		bossFound: [
    "A suffocating aura of darkness envelops the room...<br>A powerful and malevolent being awaits...",
    "A sinister, commanding presence looms before you...<br>The very air around you feels heavy with dread...",
    "An oppressive atmosphere fills the room...<br>An unspeakable terror reveals itself...",
	"An aura of malice pervades the chamber...<br>A formidable foe awaits...",
    "The walls tremble with dread...<br>A monstrous terror stands before you...",
    "An overwhelming darkness grips the room...<br>Ready yourself for the ultimate battle...",
    "A chilling presence fills the air...<br>A titanic evil prepares to strike...",
	"The atmosphere thickens with malice...<br>A daunting adversary emerges...",
    "The shadows twist and coil...<br>Revealing a terrifying presence...",
    "A sinister figure shrouded in darkness...<br>Stands as your next monumental challenge...",
    "A chilling aura surrounds you...<br>An immense foe rises before you...",
    "The very air trembles in fear...<br>As a monstrous enemy reveals itself...",
	"The air crackles with dark energy...<br>A formidable presence stands before you...",
    "An ominous aura fills the chamber...<br>A monstrous foe awaits your challenge...",
    "The shadows pulse with dread...<br>A fearsome adversary emerges...",
    "A tangible sense of evil permeates the room...<br>A colossal enemy confronts you...",
    "The darkness thickens, revealing a terrifying foe...<br>Prepare for the ultimate struggle...",
	"An air of menace fills the room...<br>A daunting presence awaits your challenge...",
    "The ground shudders beneath your feet...<br>A colossal foe prepares for battle...",
    "A palpable sense of dread grips the air...<br>As a formidable enemy rises...",
    "A chilling energy radiates from the shadows...<br>A monstrous adversary stands before you...",
    "An oppressive weight bears down upon you...<br>As a fearsome entity emerges...",
    "A sinister laugh echoes through the chamber...<br>Revealing a horrifying foe...",
    "A malevolent aura permeates the room...<br>An enormous enemy prepares to strike...",
    "The darkness surges with malevolence...<br>A fearsome foe reveals itself...",
    "An ominous presence casts a shadow over the room...<br>A powerful enemy awaits...",
    "A paralyzing sense of dread envelops you...<br>As a terrifying creature emerges...",
    "A dark energy courses through the chamber...<br>A formidable foe stands ready...",
    "An overwhelming force of evil fills the room...<br>A monstrous adversary awaits...",
    "A chilling wind sweeps through the chamber...<br>Signaling the arrival of a sinister foe...",
    "The room seems to close in on you...<br>As a malevolent presence emerges...",
    "A thunderous roar shakes the very walls...<br>A titanic enemy confronts you...",
],
		approachBoss: [
  "The ground trembles beneath your feet...<br>An unseen force draws you towards a daunting confrontation...",
  "A sinister chill runs down your spine...<br>The path ahead leads to an inevitable clash...",
  "Dark energy swirls around you, growing stronger...<br>A formidable adversary lies in wait...",
      "A sinister force tugs at your soul...<br>Drawing you towards a fateful encounter...",
    "A sense of foreboding darkens your path...<br>Guiding you to a terrible conflict...",
    "As you advance, the air grows thick with tension...<br>A battle of epic proportions awaits...",
    "The corridor narrows, the darkness thickens...<br>An adversary of great power lurks...",
    "An ominous energy gathers, palpable...<br>A monstrous challenge lies ahead...",
	 "Dread seeps into your heart...<br>As a formidable enemy draws near...",
    "The air crackles with anticipation...<br>As you inch closer to a great confrontation...",
    "A dark presence looms ahead...<br>As you prepare for the ultimate challenge...",
    "The shadows grow darker, colder...<br>An epic battle lies before you...",
    "Your heart races as you advance...<br>Bracing yourself for the fearsome foe...",
	"A cold shiver runs through your body...<br>You draw near to a fearsome adversary...",
    "As you progress, the atmosphere grows heavier...<br>An epic confrontation looms...",
    "The darkness deepens, an ominous presence awaits...<br>Steel yourself for a titanic clash...",
    "Your heart pounds as the darkness intensifies...<br>A tremendous foe lies in wait...",
    "A chill grips your soul as you press forward...<br>Brace for a harrowing battle...",
	"The darkness pulsates, a sinister force beckons...<br>As you move closer to a dreadful confrontation...",
    "An unnerving silence descends...<br>The path leads to an ominous showdown...",
    "A growing sense of dread grips your heart...<br>As you inch closer to a monstrous foe...",
    "The air feels heavy, burdened by evil...<br>A titanic enemy awaits your arrival...",
    "A malignant energy builds as you advance...<br>Guiding you towards an epic struggle...",
    "The shadows dance and twist around you...<br>A fearsome adversary lies ahead...",
    "A sinister whisper echoes in your ears...<br>Leading you to a daunting encounter...",
    "A foreboding aura envelops your path...<br>A powerful enemy draws near...",
    "The temperature drops, a malevolent presence nears...<br>Prepare for a terrifying confrontation...",
    "A sense of unease grows as you proceed...<br>An imminent clash with a dark force awaits...",
    "A dark energy permeates the air...<br>As you approach a formidable challenge...",
    "The atmosphere stifles, a dreadful presence nears...<br>Steel yourself for an epic encounter...",
    "Your instincts scream danger...<br>As you move closer to a powerful adversary...",
    "A sickening dread fills your stomach...<br>A malevolent presence lies ahead...",
    "The walls close in, the shadows deepen...<br>A fearsome battle looms...",
],
		shopEnter: [
			"You enter a dimly lit room...<br>Weapons, armor and potions strewn about...<br>A skeleton greets you with an eerie stare...",
			  "A room of flickering shadows greets you...<br>Weapons and trinkets lie in wait...<br>A bony figure watches you, unblinking...",
  "You stumble into a chamber of dim light...<br>Armaments and relics beckon...<br>An eerie skeletal sentinel observes your every move...",
  "A murky room lies before you...<br>Amidst the gloom, equipment and potions are strewn...<br>A lifeless, bony guardian greets you with empty eyes...",
  "You find yourself in a shadowy alcove...<br>Weapons, relics, and elixirs lay before you...<br>A skeletal merchant greets you, chillingly...",
    "You step into a dim chamber...<br>Amidst the darkness, arms and artifacts tempt you...<br>A bony figure scrutinizes your every move...",
    "An eerie room envelops you...<br>Cluttered with gear and potions...<br>A skeletal host watches, unblinking...",
    "You discover a gloomy sanctuary...<br>Equipment and talismans scattered about...<br>A ghastly bone trader surveys your arrival...",
    "You wander into a room bathed in shadows...<br>Surrounded by armaments and mystic items...<br>A spine-chilling skeletal figure awaits...",
    "You stumble upon a cryptic chamber...<br>Weapons, armor, and charms beckon...<br>A hollow-eyed skeletal merchant greets you...",
    "You enter a room shrouded in darkness...<br>Amidst the gloom, weapons and enchantments call...<br>A bony, spectral figure observes your presence...",
    "A candlelit room lies before you...<br>Surrounded by weapons, potions, and relics...<br>An eerie, skeletal dealer awaits your patronage...",
	"You step into a room bathed in faint light...<br>Armor, trinkets, and elixirs surround you...<br>A bony shopkeeper greets you with a hollow grin...",
    "You venture into a dimly lit chamber...<br>Weapons, charms, and potions await your perusal...<br>An eerie skeletal figure regards you silently...",
    "A mysterious room reveals itself...<br>Arms and enchanted items fill the shadows...<br>A skeletal merchant welcomes you with a hollow gaze...",
    "You find a hidden chamber cloaked in darkness...<br>Amidst the gloom, gear and mystic trinkets beckon...<br>A bony figure watches, unsettlingly...",
    "You uncover a room draped in shadows...<br>Weapons, relics, and potions lie in wait...<br>A ghostly skeletal trader stands sentinel...",
    "You come across a shadowy enclave...<br>Armaments, talismans, and elixirs call to you...<br>A spine-chilling skeletal keeper greets you...",
    "You happen upon a room dimly illuminated...<br>Surrounded by weapons, armor, and arcane items...<br>A spectral skeletal figure awaits your approach...",
    "A room of hushed whispers greets you...<br>Cluttered with arms, enchantments, and potions...<br>An unsettling bony merchant observes your entry...",
    "You enter a chamber of flickering light...<br>Amidst the darkness, relics and weapons tempt...<br>A chilling skeletal guardian stands watch...",
    "You discover a hidden room bathed in shadows...<br>Armaments, potions, and artifacts surround you...<br>A ghastly skeletal figure regards your presence...",
    "You stumble into a room of eerie silence...<br>Weapons, trinkets, and mystic items fill the space...<br>A bony, spectral merchant greets you...",
    "An arcane chamber unfolds before you...<br>Surrounded by arms, relics, and potions...<br>A macabre skeletal figure silently awaits...",
    "You make your way into a room cloaked in darkness...<br>Weapons, armor, and enchantments line the walls...<br>A hollow-eyed skeletal vendor watches your arrival...",
    "A shadowy room reveals itself to you...<br>Amidst the gloom, gear and mystic trinkets call...<br>A bony figure stands guard, unnervingly...",
    "You happen upon a chamber lit by flickering candles...<br>Weapons, potions, and relics fill the space...<br>An eerie, skeletal merchant welcomes your patronage...",
		],
		shopExit: [
			"The skeleton bids you farewell with a chilling stare...<br>You step out into the darkness once again...",
			  "The bone-laden merchant gazes upon your departure...<br>The darkness swallows you whole once more...",
  "With a silent nod from the skeletal shopkeeper...<br>You venture back into the unknown...",
  "As the lifeless vendor's gaze lingers...<br>You leave behind the relative safety of the room...",
  "As the skeletal merchant's gaze follows...<br>You step back into the cold embrace of the darkness...",
    "The bony vendor watches your departure...<br>You brace yourself for the shadows that lie ahead...",
    "With a chilling nod from the skeletal shopkeeper...<br>You venture forth, swallowed by darkness...",
    "The lifeless guardian bids you farewell...<br>You stride back into the abyss...",
    "As the bone-clad merchant's hollow gaze lingers...<br>You abandon the sanctuary for the darkness beyond...",
    "With the skeletal vendor's unblinking stare upon you...<br>You re-enter the foreboding darkness...",
    "The bony shopkeeper's gaze follows your exit...<br>Darkness once more engulfs you...",
    "A silent farewell from the skeletal merchant...<br>You step into the cold, unyielding shadows...",
	"The skeletal merchant watches as you depart...<br>The shadows envelop you once again...",
    "With a hollow gaze, the bony shopkeeper bids adieu...<br>You leave the sanctuary for the uncertainty ahead...",
    "The lifeless figure sees you off...<br>You venture forth, embraced by the darkness...",
    "As the skeletal vendor's stare lingers...<br>You walk away, shrouded in darkness once more...",
    "The bony figure nods farewell...<br>You step back into the gloom...",
    "With the skeleton's hollow eyes upon you...<br>You exit, swallowed by the shadows...",
    "A chilling glance from the bony merchant...<br>You leave the safety of the room for the darkness...",
    "As the skeletal sentinel silently observes...<br>You plunge back into the murky depths...",
    "The bone-clad vendor watches as you disappear...<br>Into the inky abyss...",
    "The skeletal figure's gaze follows you...<br>As you step back into the unknown...",
    "With the bony shopkeeper's farewell...<br>You return to the shadowy embrace...",
    "The skeleton's unblinking stare watches you depart...<br>You leave the refuge for the darkness outside...",
    "An eerie nod from the lifeless vendor...<br>You venture back into the shadows...",
    "As the skeletal merchant's gaze lingers on your exit...<br>You re-enter the darkened realm...",
    "With the bone-laden figure's eyes upon you...<br>You step forth, enshrouded in shadows once more...",
		],
		playerDeath: [
			"As the darkness claims your life...<br>Your last breath escapes, cold and alone...<br>Yet a glimmer of hope remains...",
			"Death's icy fingers claim your soul...<br>Lost within the shadows...<br>A distant spark refuses to let you go...",
			"Your strength wanes, the darkness claims your life...<br>But a whisper in the void reminds you...<br>What is dead may never die...",
			"Life slips away, consumed by the inky blackness...<br>Yet a distant voice echoes...<br>What is dead may never die...",
			"As you falter, the shadows envelop your being...<br>Your spirit lingers, for what is dead may never die...<br>A faint light calls you back...",
			"The cold void engulfs your soul, your body lifeless...<br>But you hear a faint murmur...<br>What is dead may never die...",
			"As the shadows consume your life force...<br>Your breath falters, your strength wanes...<br>But a distant glimmer of hope calls you back...",
			"Falling to the darkness, your spirit wavers...<br>Your last breath escapes, filled with sorrow...<br>Yet a faint light refuses to abandon you...",
			"The darkness seizes your soul, your body limp...<br>But a soft voice whispers...<br>What is dead may never die...",
			"The abyss claims you, your life fading...<br>Yet from the darkness, a faint glimmer beckons...",
    "Shadows envelop your spirit, your body weak...<br>But deep within, an echo murmurs...<br>What is dead may never die...",
    "As the void devours your essence...<br>Your pulse weakens, your breath stills...<br>But hope persists, a distant flicker...",
    "Death's embrace tightens, stealing your life...<br>In the darkness, a voice whispers...<br>What is dead may never die...",
    "The darkness swallows your vitality...<br>As your heartbeat slows, a distant light lingers...",
    "As your spirit fractures, shadows close in...<br>Yet within the abyss, a spark refuses to fade...",
    "The cold tendrils of death envelop you...<br>Your life fades, but a quiet voice whispers...<br>What is dead may never die...",
    "Succumbing to the shadows, your body falters...<br>Yet a feeble light calls to you, unwilling to let go...",
    "The void's grasp tightens, your life slipping away...<br>But deep in the darkness, a glint of hope remains...",
    "Darkness consumes your being, your body numb...<br>Yet a whisper in the void reminds you...<br>What is dead may never die...",
    "Death's shroud descends upon you...<br>Your life wanes, but a distant flicker holds on...",
    "You are swallowed by the cold embrace of death...<br>But a faint voice echoes...<br>What is dead may never die...",
    "The darkness engulfs you, your life force ebbing...<br>Yet a dim light fights to pull you back...",
    "As your spirit is enveloped by shadows...<br>Your breath slows, but a distant beacon remains...",
    "Fading into the abyss, your life slips away...<br>Yet a quiet voice reassures you...<br>What is dead may never die...",
		],
		
levelUp: [
  "With newfound strength coursing through your veins...<br>You feel invigorated, ready to face greater challenges...",
  "As your power grows, the darkness seems less daunting...<br>Victory seems more certain with each step...",
  "A surge of energy flows through you...<br>Empowering you to face the horrors that lie ahead...",
  "As your power swells, the darkness falters...<br>You stand ready to confront even greater foes...",
    "With each newfound strength, your determination soars...<br>The crypt's horrors seem less menacing...",
    "A newfound vigor fills you...<br>Emboldened, you stride deeper into the abyss...",
    "Your strength surges, fear wanes...<br>You stand prepared for whatever lies ahead...",
    "Empowered by growth, the darkness seems less suffocating...<br>You face the unknown with unwavering resolve...",
	"Embracing newfound power, the darkness quivers...<br>With each step, your courage grows...",
    "As your strength blossoms, your fears wither...<br>The crypt's challenges seem less insurmountable...",
    "A surge of might courses through your body...<br>Fortified, you face the crypt's terrors...",
    "With each advancement, the shadows cower...<br>Confidence fills you as you confront the darkness...",
    "Your power expands, the darkness retreats...<br>You march forward, ready for the trials ahead...",
    "As your abilities flourish, the crypt's threats fade...<br>With steadfast resolve, you press on...",
    "Newfound strength surges within you...<br>Undaunted, you navigate the crypt's perils...",
    "Empowered by progress, fear loses its grip...<br>With newfound courage, you face the abyss...",
	"As your might swells, the darkness recedes...<br>With renewed vigor, you press onward...",
    "Your power blossoms, the shadows quail...<br>Armed with newfound strength, you face the challenges ahead...",
    "A newfound energy invigorates you...<br>Emboldened, you delve deeper into the crypt...",
    "With each surge of power, your confidence grows...<br>Unwavering, you march towards the unknown...",
    "Your strength intensifies, the abyss seems less daunting...<br>With renewed courage, you confront the darkness...",
    "As your abilities thrive, the shadows falter...<br>With newfound resilience, you forge ahead...",
    "Newfound strength courses through you...<br>Undeterred, you face the crypt's horrors...",
    "Your power swells, the darkness dims...<br>With unwavering determination, you embrace the challenges...",
    "Empowered by your growth, the abyss loses its grip...<br>Fearless, you march forward...",
    "As your might flourishes, the shadows retreat...<br>With steadfast courage, you traverse the crypt...",
    "Newfound energy pulses within you...<br>With heightened resolve, you delve into the darkness...",
    "Your power surges, the crypt's terrors abate...<br>With newfound fortitude, you press onward...",
    "With each new strength, the shadows shrink...<br>Fearless, you journey deeper into the abyss...",
    "As your abilities expand, the darkness loses its hold...<br>With renewed courage, you face the trials ahead...",
    "A surge of power emboldens you...<br>With newfound determination, you confront the unknown...",
],
		newFloor: [
			"As you descend deeper into the crypt, the air grows colder...<br>Shadows dance on the walls, concealing secrets untold...",
			"The chilling air grows heavier as you venture deeper...<br>Unseen whispers haunt the corridors...",
  "You tread cautiously into the abyss, each step revealing more horrors...<br>The darkness holds its breath, waiting...",
  "Descending further, the oppressive gloom threatens to consume you...<br>Yet you press on, determined to conquer the unknown...",
   "Deeper still, you delve into the abyss...<br>With each step, the shadows grow more sinister...",
    "You descend, the air thick with darkness...<br>Untold horrors lurk around every corner...",
    "As you proceed downward, the crypt's secrets deepen...<br>A shroud of unease envelops you...",
    "The crypt's depths beckon, cold and unyielding...<br>What awaits in the darkness remains a mystery...",
    "With each level, the crypt's grip tightens...<br>Yet your resolve remains unshaken...",
	"As you delve further, the darkness clings tighter...<br>Ever more ominous secrets lie in wait...",
    "The crypt's labyrinth twists deeper...<br>Shrouded in shadows and secrets...",
    "Each step into the abyss reveals greater terrors...<br>Darkness whispers, promising despair...",
    "Descending deeper, the air grows more oppressive...<br>As the crypt's hidden horrors lie in wait...",
    "The shadows thicken with each new level...<br>Chilling whispers echo through the crypt...",
	"As you venture further, the darkness tightens its embrace...<br>Shadows dance with sinister intent...",
    "Deeper into the crypt, the air becomes icy...<br>Whispers of unseen horrors fill the silence...",
    "You delve into the abyss, the darkness intensifying...<br>The crypt's secrets remain shrouded...",
    "With each descent, the crypt's chill deepens...<br>The weight of unseen dread looms...",
    "Descending further, shadows coil around you...<br>Mysterious whispers haunt your every step...",
    "As you probe the crypt's depths, the air thickens...<br>Hidden terrors lurk in the inky blackness...",
    "The deeper you venture, the more the shadows stir...<br>Secrets locked away in the darkness beckon...",
    "With each level, the crypt's embrace grows colder...<br>Whispers of despair echo through the gloom...",
    "As you delve deeper, the darkness whispers...<br>The crypt's mysteries remain just out of reach...",
    "The shadows grow denser as you journey further...<br>What lies in the darkness remains veiled...",
    "Descending into the crypt, the air chills your bones...<br>Hidden secrets linger in the shadows...",
    "Each step deeper into the abyss unveils new horrors...<br>The crypt's whispers grow ever more haunting...",
    "As you proceed, the darkness envelops you...<br>The crypt's secrets whisper, drawing you in...",
    "With each descent, the air grows colder still...<br>As the crypt's mysteries remain locked away...",
    "Deeper still, the shadows envelop you...<br>As the crypt's untold secrets stir within the darkness...",
		],
		err: "An unexpected error occurred. Please try again.",
	},

	
    enemies: [
  { name: 'Goblin', difficulty: 'easy', maxHp: 25, attack: 7, gold: 5, exp: 4 },
  { name: 'Zombie', difficulty: 'easy', maxHp: 28, attack: 8, gold: 6, exp: 4 },
  { name: 'Mimic', difficulty: 'easy', maxHp: 30, attack: 9, gold: 8, exp: 5 },
  { name: 'Gnoll', difficulty: 'easy', maxHp: 26, attack: 7, gold: 6, exp: 4 },
  { name: 'Giant Rat', difficulty: 'easy', maxHp: 24, attack: 6, gold: 5, exp: 3 },
  { name: 'Orc', difficulty: 'easy', maxHp: 29, attack: 9, gold: 8, exp: 5 },
  { name: 'Kobold', difficulty: 'easy', maxHp: 27, attack: 8, gold: 6, exp: 4 },
  { name: 'Hobgoblin', difficulty: 'easy', maxHp: 32, attack: 10, gold: 9, exp: 5 },
  { name: 'Spiderling', difficulty: 'easy', maxHp: 22, attack: 6, gold: 4, exp: 3 },
  { name: 'Wolf', difficulty: 'easy', maxHp: 25, attack: 8, gold: 5, exp: 4 },
  { name: 'Mud Golem', difficulty: 'easy', maxHp: 24, attack: 6, gold: 6, exp: 3 },
  { name: 'Will-o-Wisp', difficulty: 'easy', maxHp: 20, attack: 5, gold: 4, exp: 3 },
  { name: 'Lesser Elemental', difficulty: 'easy', maxHp: 21, attack: 5, gold: 6, exp: 3 },
  { name: 'Slime', difficulty: 'easy', maxHp: 20, attack: 4, gold: 5, exp: 3 },
  { name: 'Dark Sprite', difficulty: 'easy', maxHp: 22, attack: 5, gold: 5, exp: 3 },
  { name: 'Living Armor', difficulty: 'easy', maxHp: 23, attack: 6, gold: 7, exp: 3 },
  { name: 'Gelatinous Cube', difficulty: 'easy', maxHp: 27, attack: 5, gold: 6, exp: 3 },
  { name: 'Necromancer Acolyte', difficulty: 'easy', maxHp: 25, attack: 7, gold: 8, exp: 4 },
  { name: 'Wyvern Hatchling', difficulty: 'easy', maxHp: 19, attack: 6, gold: 5, exp: 3 },
  { name: 'Imp', difficulty: 'medium', maxHp: 35, attack: 13, gold: 11, exp: 6 },
  { name: 'Wendigo', difficulty: 'medium', maxHp: 47, attack: 17, gold: 18, exp: 9 },
{ name: 'Kelpie', difficulty: 'medium', maxHp: 36, attack: 11, gold: 10, exp: 6 },
  { name: 'Dryad', difficulty: 'medium', maxHp: 37, attack: 12, gold: 11, exp: 6 },
{ name: 'Phantom', difficulty: 'medium', maxHp: 40, attack: 14, gold: 13, exp: 8 },
{ name: 'Harpy', difficulty: 'medium', maxHp: 36, attack: 12, gold: 10, exp: 6 },
{ name: 'Banshee', difficulty: 'medium', maxHp: 45, attack: 16, gold: 16, exp: 9 },
{ name: 'Djinn', difficulty: 'medium', maxHp: 46, attack: 15, gold: 12, exp: 7 },
{ name: 'Basilisk', difficulty: 'medium', maxHp: 34, attack: 10, gold: 13, exp: 6 },
{ name: 'Wererat', difficulty: 'medium', maxHp: 33, attack: 11, gold: 12, exp: 6 },
{ name: 'Ice Wraith', difficulty: 'medium', maxHp: 39, attack: 13, gold: 15, exp: 8 },
{ name: 'Succubus', difficulty: 'medium', maxHp: 37, attack: 12, gold: 14, exp: 7 },
{ name: 'Troll', difficulty: 'medium', maxHp: 44, attack: 18, gold: 18, exp: 10 },
{ name: 'Treant', difficulty: 'medium', maxHp: 38, attack: 14, gold: 14, exp: 7 },
{ name: 'Giant Spider', difficulty: 'medium', maxHp: 39, attack: 14, gold: 13, exp: 7 },
{ name: 'Centaur', difficulty: 'medium', maxHp: 41, attack: 16, gold: 16, exp: 9 },
{ name: 'Griffin', difficulty: 'medium', maxHp: 42, attack: 15, gold: 15, exp: 8 },
  { name: 'Necromancer', difficulty: 'hard', maxHp: 66, attack: 26, gold: 32, exp: 17 },
{ name: 'Ogre', difficulty: 'hard', maxHp: 62, attack: 22, gold: 24, exp: 12 },
{ name: 'Wraith', difficulty: 'hard', maxHp: 52, attack: 24, gold: 26, exp: 13 },
{ name: 'Cyclops', difficulty: 'hard', maxHp: 68, attack: 27, gold: 30, exp: 16 },
{ name: 'Shadow Fiend', difficulty: 'hard', maxHp: 58, attack: 23, gold: 25, exp: 13 },
{ name: 'Hellhound', difficulty: 'hard', maxHp: 64, attack: 29, gold: 33, exp: 17 },
{ name: 'Gargoyle', difficulty: 'hard', maxHp: 52, attack: 22, gold: 22, exp: 11 },
{ name: 'Lich', difficulty: 'hard', maxHp: 72, attack: 31, gold: 31, exp: 18 },
{ name: 'Minotaur', difficulty: 'hard', maxHp: 65, attack: 25, gold: 28, exp: 14 },
{ name: 'Earth Elemental', difficulty: 'hard', maxHp: 70, attack: 27, gold: 31, exp: 16 },
{ name: 'Air Elemental', difficulty: 'hard', maxHp: 55, attack: 26, gold: 29, exp: 15 },
{ name: 'Fire Elemental', difficulty: 'hard', maxHp: 60, attack: 28, gold: 32, exp: 16 },
{ name: 'Water Elemental', difficulty: 'hard', maxHp: 58, attack: 23, gold: 26, exp: 14 },
{ name: 'Vampire', difficulty: 'hard', maxHp: 63, attack: 30, gold: 33, exp: 18 },
{ name: 'Giant', difficulty: 'hard', maxHp: 69, attack: 29, gold: 35, exp: 19 },
{ name: 'Manticore', difficulty: 'hard', maxHp: 61, attack: 26, gold: 30, exp: 15 },
{ name: 'Chimera', difficulty: 'hard', maxHp: 66, attack: 28, gold: 36, exp: 19 },
],

    encounters: [
    { type: 'enemy', chance: 70 },
    { type: 'nothing', chance: 20 },
    { type: 'healing', chance: 10 },
	{ type: 'boss', chance: 12 },
    ],
	
settings: {
	trackVolume: 0.2, effectVolume: 0.2,
},
	

};
})();
	
let scale = {
  baseMaxHp: 100, baseAttack: 10, baseMaxExp: 20, basePot: 10,
  maxHpInc: 30, atkInc: 7, maxExpMulti: 1.4,
  wBonus: 8, aBonus: 33, potHeal: 50,
  scaling: 0.13, bossScaling: 1.7,
  healMin: 20, healMax: 50,
  minDmgMulti: 0.6, maxDmgMulti: 1.4,
  wCostBase: 70, aCostBase: 70, potCost: 15,
};
	
	
let plr = {
  exp: 0, hp: scale.baseMaxHp, gold: 0, wTier: 0, aTier: 0, pot: scale.basePot, flr: 1,
  flrB: null, fndB: false, deadB: false, enmy: [], trk: null, };
	
const tryCatch = (func) => {
	return function(...args) {
    try {
		return func.apply(this, args);
	} catch (error) {
		console.error(error);
		msg(game.text.err);
    }
  };
},

clone = (obj) => {
		return JSON.parse(JSON.stringify(obj));
},

pStats = (exp) => {
    let level = 1, totalExp = scale.baseMaxExp, expRequiredForNextLevel = totalExp;

    while (exp >= expRequiredForNextLevel) {
		level++;
        totalExp += expRequiredForNextLevel;
        expRequiredForNextLevel = Math.floor(scale.baseMaxExp * Math.pow(scale.maxExpMulti, level - 1));
	}
	const weaponAttack = plr.wTier * scale.wBonus;
	const armorHp = plr.aTier * scale.aBonus;
    return {
        level: level,
        maxHp: scale.baseMaxHp + (level - 1) * scale.maxHpInc + armorHp,
        attack: scale.baseAttack + (level - 1) * scale.atkInc + weaponAttack,
        maxExp: expRequiredForNextLevel,
	};
},
	
dmg = (attack) => {
	const minDamage = attack * scale.minDmgMulti | 0;
	const maxDamage = attack * scale.maxDmgMulti | 0;
	return (Math.random() * (maxDamage - minDamage + 1) + minDamage) | 0;
},

updateHp = (amount) => {
  plr.hp = Math.min(plr.hp + amount, pStats(plr.exp).maxHp);
},

msg = (text, append = false) => {
	loadStats();
	if (!text) return;
	message.innerHTML = append ? message.innerHTML + text + '<br>' : text + '<br>';
},

loadStats = () => {
	const currentPlayerStats = pStats(plr.exp);
	status.innerHTML = `HP: ${plr.hp}/${currentPlayerStats.maxHp}<br>Level: ${currentPlayerStats.level}<br>Exp: ${plr.exp}/${currentPlayerStats.maxExp}<br>Floor: ${plr.flr}<br>Attack: ${currentPlayerStats.attack}<br>Gold: ${plr.gold}<br>Potions: ${plr.pot}<br>Weapon Tier: ${plr.wTier}<br>Armor Tier: ${plr.aTier}`;
	updBossBtn();
},

death = () => {
	const goldLoss = plr.gold / 2 | 0;
	plr.gold -= goldLoss;
	const playerStatsBeforeDeath = pStats(plr.exp);
	if (playerStatsBeforeDeath.level === 1) {
		plr.exp = 0;
	} else {
		const newLevel = Math.max(playerStatsBeforeDeath.level - 1, 1);
		let previousLevelStats = pStats(plr.exp - 1);
		while (previousLevelStats.level >= newLevel) {
			plr.exp--;
			previousLevelStats = pStats(plr.exp - 1);
		}
    }
    plr.flr = Math.max(plr.flr - 1, 1);
    plr.hp = pStats(plr.exp).maxHp;
	
	playTrack();
    genEnemies();
	plr.fndB = false;
	plr.deadB = false;
	saveGame();
	
    msg(randDlg('playerDeath'), true);
    msg(`You return to level ${pStats(plr.exp).level}, floor ${plr.flr} and have ${plr.gold} gold left.`, true);
	play(game.soundEffects.playerDeath, game.settings.effectVolume);
},

lvl = () => {
	const currentPlayerStats = pStats(plr.exp);
	plr.hp = currentPlayerStats.maxHp;
	msg(randDlg('levelUp'), true);
	msg(`Congratulations! You reached level ${currentPlayerStats.level}!<br>Your max HP and attack have increased!`, true);
	play(game.soundEffects.levelUp, game.settings.effectVolume);
},

fight = (enemyTemplate) => {
	setBtns(false, false);
	combatBtns.style.display = 'block';
	
	const enemy = clone(enemyTemplate);
	updateEnemyStats(enemy);
	const damageToPlayer = dmg(enemy.attack);
	
	const fightBtn = el('fightBtn');
	const runBtn = el('runBtn');
	
	fightBtn.onclick = () => {
		const currentPlayerStats = pStats(plr.exp);
		const damageToEnemy = dmg(currentPlayerStats.attack);
		
		enemy.hp -= damageToEnemy;
		plr.hp -= damageToPlayer;
		updateEnemyStats(enemy);
		if (plr.hp <= 0) {
			msg(`You dealt ${damageToEnemy} damage to the ${enemy.name}.<br>The ${enemy.name} defeated you.`);
			death();
			resetUI();
		} else if (enemy.hp <= 0) {
			plr.gold += enemy.gold;
			plr.exp += enemy.exp;
			msg(`The ${enemy.name} dealt ${damageToPlayer} damage to you.<br>You dealt ${damageToEnemy} damage to the ${enemy.name} and defeated it!<br>You earned ${enemy.gold} gold and ${enemy.exp} exp!`);
			
			(plr.exp >= currentPlayerStats.maxExp) ? lvl() : play(game.soundEffects.victory, game.settings.effectVolume);
			
			if (enemy.isFloorBoss) {
				plr.deadB = true;
				msg(randDlg(`defeatBoss`), true);
			}
		resetUI();
		} else {
			msg(`You dealt ${damageToEnemy} damage to the ${enemy.name}.<br>The ${enemy.name} dealt ${damageToPlayer} damage to you.`);
		}
	}
  
	runBtn.onclick = () => {
		plr.hp -= damageToPlayer;
		if (plr.hp <= 0) {
			msg(`You fled from the ${enemy.name}.<br>But took ${damageToPlayer} damage while running away and were defeated.`);
			death();
		} else {
			msg(`You fled from the ${enemy.name}.<br>But took ${damageToPlayer} damage while running away.`);
		}
		resetUI();
	};	
},


encounter = {
	enemy: () => {
		msg(randDlg(`enemyEncounter`));
			msg(`What will you do?`, true);
			const randomIndex = Math.random() * plr.enmy.length | 0;
			const enemyName = plr.enmy[randomIndex];
			const scaledEnemy = scaleEnemy(enemyName);
			fight(scaledEnemy);
	},
	nothing: () => {
		msg(randDlg(`nothingFound`));
	},
	healing: () => {
		const healingAmount = (Math.random() * (scale.healMax - scale.healMin) | 0) + scale.healMin;
		updateHp(healingAmount);
		msg(randDlg(`healingShrine`));
		msg(`You recovered ${healingAmount} HP!`, true);
	},
	boss: () => {
		plr.fndB = true;
		msg(randDlg(`bossFound`));
		msg(`You found the floor boss!`, true);
		const floorBossCopy = scaleEnemy(plr.flrB, true);
		updateEnemyStats(floorBossCopy);
	}
},

explore = tryCatch(function() {
	updateEnemyStats(null);
	const encounterType = randEncounter();
	encounter[encounterType]();
}),

fightFloorBoss = tryCatch(function() {
	if (plr.flrB) {
		const floorBossCopy = scaleEnemy(plr.flrB, true);
		msg(randDlg(`approachBoss`));
		fight(floorBossCopy);
	} else {
		msg(`You haven't found the floor boss yet.`);
	}
}),

randEncounter = () => {
	const validEncounters = game.encounters.filter(
	(encounter) => encounter.type !== `boss` || !plr.fndB );
	const totalChance = validEncounters.reduce(
	(acc, cur) => acc + cur.chance, 0 );
	let randomChance = Math.random() * totalChance | 0;
	for (const encounter of validEncounters) {
		if (randomChance < encounter.chance) {
			return encounter.type;
		}
	randomChance -= encounter.chance;
	}
},
  
randEnemy = (difficulty) => {
	const filteredEnemies = game.enemies.filter(enemy => !difficulty || enemy.difficulty === difficulty);
	const randomIndex = Math.random() * filteredEnemies.length | 0;
	const enemy = clone(filteredEnemies[randomIndex]);
	enemy.hp = enemy.maxHp;
	return enemy;
},

updateEnemyStats = (enemy) => {
	enemy ? (enemyStats.innerHTML = `${enemy.name}<br>HP: ${enemy.hp}<br>Attack: ${enemy.attack}<br>`, enemyStats.style.display = 'block') : (enemyStats.innerHTML = '', enemyStats.style.display = 'none');
},

genEnemies = tryCatch(function() {
	let selectedEnemies = new Set(), availableEnemies;
	plr.flr === 1 ? 
	Array(3).fill(null).forEach(() => selectedEnemies.add(randEnemy('easy').name)) :
	['easy', 'medium', 'hard'].forEach(difficulty => selectedEnemies.add(randEnemy(difficulty).name));
	plr.enmy = [...selectedEnemies];
	const floorBoss = game.enemies
	.filter(enemy => plr.enmy.includes(enemy.name))
	.map((_, index, availableEnemies) => availableEnemies[Math.random() * availableEnemies.length | 0])[0];
	plr.flrB = floorBoss.name;
}),

scaleEnemy = (enemyName, isFloorBoss = false) => {
	const enemyTemplate = game.enemies.find((enemy) => enemy.name === enemyName);
	const scalingFactor = 1 + (plr.flr - 1) * scale.scaling;
	const scaledEnemy = clone(enemyTemplate);
	scaledEnemy.maxHp = scaledEnemy.maxHp * scalingFactor | 0;
	scaledEnemy.attack = scaledEnemy.attack * scalingFactor | 0;
	scaledEnemy.gold = scaledEnemy.gold * scalingFactor | 0;
	scaledEnemy.exp = scaledEnemy.exp * scalingFactor | 0;
	scaledEnemy.hp = scaledEnemy.maxHp;
	if (isFloorBoss) {
		const bossScaling = scale.bossScaling;
		scaledEnemy.isFloorBoss = true;
		scaledEnemy.name += ` (Floor Boss)`;
		scaledEnemy.maxHp = scaledEnemy.maxHp * bossScaling | 0;
		scaledEnemy.attack = scaledEnemy.attack * bossScaling | 0;
		scaledEnemy.gold = scaledEnemy.gold * bossScaling | 0;
		scaledEnemy.exp = scaledEnemy.exp * bossScaling | 0;
		scaledEnemy.hp = scaledEnemy.maxHp;
	}
	return scaledEnemy;
},

nextFloor = tryCatch(function() {
	plr.flr++;
	plr.flrB = null;
	plr.fndB = false;
	plr.deadB = false;
	msg(randDlg('newFloor'));
	msg(`You've reached floor ${plr.flr}!`, true);
	playTrack();
	play(game.soundEffects.nextFloor, game.settings.effectVolume);
	genEnemies();
	updateEnemyStats(null);
});

randDlg = (scenario) => {
    return game.text[scenario][Math.floor(Math.random() * game.text[scenario].length)];
},

setBtns = (enable, visible, fightBtns) => {
	const display = visible ? 'inline' : 'none';
	[exploreBtn, usePotBtn, maxPotionsBtn, shopBtn, fightBossBtn, settingsBtn, saveBtn, loadBtn, exportBtn, importBtn].forEach(btn => {
		btn.style.display = display;
		btn.disabled = !enable;
	});
	updBossBtn();
},

updBossBtn = () => {
  (plr.deadB) ? (fightBossBtn.textContent = 'Next Floor', fightBossBtn.onclick = nextFloor, fightBossBtn.disabled = !plr.deadB) : (fightBossBtn.textContent = 'Fight Boss', fightBossBtn.onclick = fightFloorBoss, fightBossBtn.disabled = !plr.fndB);
},

resetUI = () => {
  setBtns(true, true);
  updateEnemyStats(null);
  combatBtns.style.display = 'none';
},

usePot = tryCatch(function(max = false) {
	const currentPlayerStats = pStats(plr.exp);
	let potionsUsed = 0;
	let healthRestored = 0;
	
	if (max) {
		while (plr.pot > 0 && plr.hp < currentPlayerStats.maxHp) {
			const healingAmount = max ? Math.min(scale.potHeal, currentPlayerStats.maxHp - plr.hp) : scale.potHeal;
			updateHp(healingAmount);
			healthRestored += healingAmount;
			plr.pot--;
			potionsUsed++;
		}
	} else {
		if (plr.pot > 0 && plr.hp < currentPlayerStats.maxHp) {
			const healingAmount = scale.potHeal;
			updateHp(healingAmount);
			plr.pot--;
			potionsUsed = 1;
			healthRestored = healingAmount;
		}
	}
	if (potionsUsed > 0) {
		msg(`You used ${potionsUsed} potion(s) and recovered ${healthRestored} HP!`);
	} else if (plr.hp >= currentPlayerStats.maxHp) {
		msg('Your HP is already full.');
	} else {
		msg(`You don't have any potions left.`);
	}
  updateEnemyStats(null);
}),

itemCost = (itemType, itemTier) => {
	const costBase = itemType === 'weapon' ? scale.wCostBase : scale.aCostBase;
	return itemTier * costBase + costBase;
},

updCost = () => {
	const currentWeaponCost = itemCost('weapon', plr.wTier);
	const currentArmorCost = itemCost('armor', plr.aTier);
	const potionCost = scale.potCost;
	const maxPotions = Math.floor(plr.gold / potionCost);
	const maxPotionCost = maxPotions * potionCost;
	
	el('weaponCost').textContent = `${currentWeaponCost} gold`;
	el('armorCost').textContent = `${currentArmorCost} gold`;
	el('potionCost').textContent = `${potionCost} gold`;
	el('maxPotionCost').textContent = `${maxPotionCost} gold`;
},

tglShop = () => {
	const isShopOpen = shop.style.display === 'block';
	if (isShopOpen) {
		msg(randDlg('shopExit'));
		setBtns(true, true);
	} else {
		msg(randDlg('shopEnter'));
		setBtns(false, false);
		updCost();
	}
	shop.style.display = isShopOpen ? 'none' : 'block';
	updateEnemyStats(null);
},

buyItem = tryCatch(function(itemType) {
	const itemTier = itemType === 'weapon' ? plr.wTier : plr.aTier;
	const cost = itemCost(itemType, itemTier);
	
	if (plr.gold < cost) return msg(`You don't have enough gold to upgrade your ${itemType}.`);
	plr.gold -= cost;
	if (itemType === 'weapon') {
		plr.wTier++;
		msg(`You upgraded your weapon to Tier ${plr.wTier}.`);
	} else {
		plr.aTier++;
		plr.hp += scale.aBonus;
		msg(`You upgraded your armor to Tier ${plr.aTier}.`);
	}
	updCost();
}),

buyPots = tryCatch(function(max = false) {
	const potionCost = scale.potCost;
	const maxPotions = Math.floor(plr.gold / potionCost);
	const totalCost = max ? maxPotions * potionCost : potionCost;
	const boughtPotions = max ? maxPotions : 1;
	
	if (plr.gold >= totalCost && boughtPotions > 0) {
		plr.gold -= totalCost;
		plr.pot += boughtPotions;
		msg(`You bought ${boughtPotions} potion(s) for ${totalCost} gold.<br>You now have ${plr.pot} potions.`);
		updCost();
	} else {
		msg(`You don't have enough gold to buy any potions.`);
	}
}),








sLS = (k, d) => {localStorage.setItem(k, btoa(JSON.stringify(d)));}, // saveToLocalStorage
lLS = (k) => {const d = localStorage.getItem(k); return d ? JSON.parse(atob(d)) : null;}, // loadFromLocalStorage

saveGame = tryCatch((auto = true) => {
  sLS('SerRat&ChatGPTsEndlessTextBasedRPG.save', valPlrData(plr));
  auto ? console.log('autosave successful') : msg('Game saved successfully!<br>Please note that clearing browser cache will wipe save data!');
}),

loadGame = tryCatch(() => {
  const lp = lLS('SerRat&ChatGPTsEndlessTextBasedRPG.save'); // loadedPlayer
  if (lp) {plr = valPlrData(lp); msg('Game loaded successfully!'); msg(randDlg('loadGame'), true); playTrack(plr.trk); updateEnemyStats(null);  } else {msg('No saved game data found.');}
}),

exportSave = tryCatch(() => {
  const sd = lLS('SerRat&ChatGPTsEndlessTextBasedRPG.save'); // saveData
  if (sd) {const a = document.createElement('a'); a.href = 'data:text/plain;charset=utf-8,' + btoa(JSON.stringify(sd)); a.download = 'descentIntoDarkness.save'; a.style.display = 'none'; document.body.appendChild(a); a.click(); document.body.removeChild(a); msg('Save file exported successfully!');} else {msg('No saved game data found.');}
}),

importSave = tryCatch(e => {
  const f = e.target.files[0]; // file
  if (f) {
    const r = new FileReader(); // reader
    r.onload = e => {
      try {const lp = JSON.parse(atob(e.target.result)); sLS('SerRat&ChatGPTsEndlessTextBasedRPG.save', valPlrData(lp)); loadGame(); msg('Save file imported successfully!');} catch (err) {handleError(err);}
    };
    r.readAsText(f);
  }
}),

triggerFileInput = () => {fileInput.click();},

resetSaveData = () => {
  if (confirm('Are you sure you want to reset your save data? This action cannot be undone.')) {
	tglSet(); localStorage.removeItem('SerRat&ChatGPTsEndlessTextBasedRPG.save');
	msg('Save data reset successfully.');
	startGame();
  }
},
 
valPlrData = (playerData) => {
  const defaultPlayer = plr;
  const oldToNewKeys = {
    weaponTier: 'wTier',
    armorTier: 'aTier',
    potions: 'pot',
    floor: 'flr',
    floorBoss: 'flrB',
    foundBoss: 'fndB',
    bossDead: 'deadB',
    enemiesOnFloor: 'enmy',
    selectedTrack: 'trk'
  };

  const filteredPlayerData = {};

  for (const key in defaultPlayer) {
    const oldKey = Object.keys(oldToNewKeys).find(oldKey => oldToNewKeys[oldKey] === key);
    const useOldKey = oldKey && playerData.hasOwnProperty(oldKey) && playerData[oldKey] !== null;

    if ((playerData.hasOwnProperty(key) && playerData[key] != null) || useOldKey) {
  filteredPlayerData[key] = useOldKey ? playerData[oldKey] : playerData[key];
  if (useOldKey) console.warn(`Recovering save data: using old key ${oldKey}, updating to new key ${key}.`);
  } else {
      console.warn(`Recovering save data: missing or corrupt key ${key}, using default value.`);
      filteredPlayerData[key] = defaultPlayer[key];
    }
  }
  const validEnemyNames = game.enemies.map(enemy => enemy.name);
  if (filteredPlayerData.enmy) {
  const invalidEnemies = filteredPlayerData.enmy.filter(enemy => !validEnemyNames.includes(enemy));
  if (invalidEnemies.length) {
    console.error(`Recovering save data: invalid enemy type(s) found: ${invalidEnemies.join(', ')}. Rerolling enemies on floor and boss.`);
    genEnemies();
  }
} else {
  console.error('Recovering save data: enemiesOnFloor is missing or invalid. Rerolling enemies on floor and boss.');
  genEnemies();
}

  return filteredPlayerData;
};

let audioContext, compressor, gainNode,loopedSource, waveformType, lowPassStrength, ADSR, gapDuration, fadeInDuration, fadeOutDuration;

function nToFreq(note) {
  const noteToNumber = {
    'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
  };
  const keyNumber = noteToNumber[note.slice(0, -1)] + 12 * parseInt(note.slice(-1));

  return 440 * Math.pow(2, (keyNumber - 49) / 12);
}

async function initAC() {
  if (!audioContext) {
  
  audioContext = new (window.AudioContext || window.webkitAudioContext)();
  compressor = audioContext.createDynamicsCompressor();

//sounds settings
  compressor.threshold.value = -40;
  compressor.knee.value = 40;
  compressor.ratio.value = 8;
  compressor.attack.value = 0.001;
  compressor.release.value = 0.1;

	waveformType = 'sawtooth';
	
ADSR = {
  attack: 0.004,
  decay: 0.14,
  sustain: 0.38,
  release: 0.18,
};

lowPassStrength = 0.7;
gapDuration = 0.001;
fadeInDuration = 0.002;
fadeOutDuration = 0.002;
	//end of sound settings
	
	gainNode = audioContext.createGain();
  gainNode.connect(compressor);
  compressor.connect(audioContext.destination);
	
}
  
  if (audioContext.state === 'suspended') {
    await audioContext.resume();
  }
}

const play = tryCatch(async function(melody, volume, loop = false) {
  await initAC();
  
  if (!loop && volume == 0) return;

  const source = Object.assign(audioContext.createBufferSource(), { buffer: gBuf(melody), loop });

  if (loop) {
    loopedSource && loopedSource.disconnect(gainNode);
    loopedSource = source;
    loopedMelody = { melody, volume };
  } else {
    if (loopedSource) {
      loopedSource.disconnect(gainNode);
      source.onended = () => {
        loopedSource.connect(gainNode);
        gainNode.gain.value = game.settings.trackVolume;
      };
    }
  }

  setVCS(source, volume, loop);
  return source;
});

function gBuf(melody) {

  const melodyDuration = melody.reduce((acc, note) => acc + note[1] + gapDuration, 0);
  const audioBuffer = audioContext.createBuffer(1, audioContext.sampleRate * melodyDuration, audioContext.sampleRate);
  const audioBufferData = audioBuffer.getChannelData(0);

  let currentSample = 0;

  for (const [note, duration] of melody) {
  const [frequency, samplesPerCycle, cycles] = [nToFreq(note), Math.round(audioContext.sampleRate / nToFreq(note)), Math.round(duration * audioContext.sampleRate)];

  for (let i = 0; i < cycles; i++) {
    audioBufferData[currentSample++] = gWS(i, samplesPerCycle, waveformType);
  }
  aADSR_LP(audioBufferData.subarray(currentSample - cycles, currentSample), audioContext.sampleRate);
  currentSample += Math.round(gapDuration * audioContext.sampleRate);
}

  return audioBuffer;
}

function gWS(i, samplesPerCycle, waveformType) {
  switch (waveformType) {
    case 'square':
      return ((((i % samplesPerCycle) / samplesPerCycle) < 0.5 ? 1 : -1) * 0.1);
    case 'triangle':
      return (temp => temp > 1 ? 2 - temp : temp)(4 * (i % samplesPerCycle) / samplesPerCycle - 1);
    case 'sawtooth':
      return ((2 * (i % samplesPerCycle) / samplesPerCycle - 1) * 0.1);
    case 'sine':
    default:
      return Math.sin(2 * Math.PI * (i % samplesPerCycle) / samplesPerCycle);
  }
}

function aADSR_LP(buffer, sampleRate) {
  const ADSRValues = [
    Math.round(sampleRate * fadeInDuration),
    Math.round(sampleRate * fadeOutDuration),
    ...[ADSR.attack, ADSR.decay, ADSR.release].map(x => Math.round(sampleRate * x)),
    ADSR.sustain
  ];

  let prevOutput = 0;
  for (let i = 0; i < buffer.length; i++) {
    buffer[i] = prevOutput + lowPassStrength * (buffer[i] - prevOutput);
    prevOutput = buffer[i];

    buffer[i] *= i < ADSRValues[0] ? i / ADSRValues[0] :
            i < ADSRValues[2] ? i / ADSRValues[2] :
            i < ADSRValues[2] + ADSRValues[3] ? ADSRValues[5] + (1 - ADSRValues[5]) * (1 - (i - ADSRValues[2]) / ADSRValues[3]) :
            i >= buffer.length - ADSRValues[4] - ADSRValues[1] ? (buffer.length - i - ADSRValues[1]) / ADSRValues[4] :
            i >= buffer.length - ADSRValues[1] ? (buffer.length - i) / ADSRValues[1] :
            ADSRValues[5];
  }
}

const setVCS = (source, volume, loop = false) => {
  if (!loop && volume == 0) return;
  source.connect(gainNode);
  gainNode.gain.value = volume;
  source.start();
};

function playTrack(track = null) {
  play(
  track && game.soundTracks.hasOwnProperty(track) ? game.soundTracks[track] : (() => {
    const soundtrackKeys = Object.keys(game.soundTracks);
    const randomKey = soundtrackKeys[Math.floor(Math.random() * soundtrackKeys.length)];
    plr.trk = randomKey;
    return game.soundTracks[randomKey];
  })(),
  game.settings.trackVolume,
  true
);
}

function tglSet() {
  const isSettingsOpen = settingsMenu.style.display === 'block';
  settingsMenu.style.display = isSettingsOpen ? 'none' : 'block';
  gameContainer.style.display = isSettingsOpen ? 'flex' : 'none';
}

function updVol(volumeType, volume) {
  game.settings[volumeType] = parseFloat(volume.target.value) / 100 * 0.4;
  if (volumeType === 'trackVolume') {
    gainNode.gain.value = game.settings.trackVolume;
  }
  updSlid();
  sSet();
}

function updSlid() {
  trackVolume.value = game.settings.trackVolume * 100 / 0.4;
  effectVolume.value = game.settings.effectVolume * 100 / 0.4;

  [trackVolumeValue, effectVolumeValue].forEach((elem, i) => elem.textContent = `${[trackVolume, effectVolume][i].value}%`);
}

const sSet = () => localStorage.setItem('SerRat&ChatGPTsEndlessTextBasedRPG.settings', JSON.stringify(game.settings));

function lSet() {
  const storedSettings = localStorage.getItem('SerRat&ChatGPTsEndlessTextBasedRPG.settings');
  if (storedSettings) {
    game.settings = JSON.parse(storedSettings);
  }
  updSlid();
}

function startGame() {
	titleScreen.style.display = 'none';
	gameContainer.style.display = 'flex';
	if (localStorage.getItem('SerRat&ChatGPTsEndlessTextBasedRPG.save') != null) {
		loadGame();
		updBossBtn();
	} else {
		plr = {
  exp: 0, hp: scale.baseMaxHp, gold: 0, wTier: 0, aTier: 0, pot: scale.basePot, flr: 1,
  flrB: null, fndB: false, deadB: false, enmy: [], trk: null, };
  
		playTrack();
		genEnemies();
		updateEnemyStats(null);
		msg(randDlg('startGame'), true);
	}
	
}

startBtn.onclick = startGame;
exploreBtn.onclick = explore;
usePotBtn.onclick = () => { usePot(false); };
maxPotionsBtn.onclick = () => { usePot(true); };
shopBtn.onclick = tglShop;
closeShopBtn.onclick = tglShop;
buyWeaponBtn.onclick = () => { buyItem('weapon') };
buyArmorBtn.onclick = () => { buyItem('armor') };
buyPotionBtn.onclick = () => { buyPots(false); };
buyMaxPotionsBtn.onclick = () => { buyPots(true); };
fightBossBtn.onclick = fightFloorBoss;
  
saveBtn.onclick = () => { saveGame(false); };
loadBtn.onclick = loadGame;
exportBtn.onclick = exportSave;
importBtn.onclick = triggerFileInput;
fileInput.onchange = importSave;
resetSaveBtn.onclick = resetSaveData;

settingsBtn.onclick = tglSet;
closeSettingsBtn.onclick = tglSet;
trackVolume.oninput = (event) => updVol('trackVolume', event);
effectVolume.oninput = (event) => updVol('effectVolume', event);

lSet();
  
});
</script>
</body>
</html>